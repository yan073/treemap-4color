function setLeavesColor(s,e="data-cluster",r=4,f=5){let u=document.querySelectorAll("["+e+"]");var t=function(){for(var o={},t=0;t<u.length;t++)o[t]=[];for(var e,r,n,t=0;t<u.length-1;t++)for(var l=s(u[t]),i=t+1;i<u.length;i++){var a=s(u[i]);r=a,n=void 0,((n=(o,t)=>Math.abs(o-t)<f)((e=l).top,r.bottom)||n(e.bottom,r.top)?e.left>r.right||e.right<r.left:!n(e.left,r.right)&&!n(e.right,r.left)||e.top>r.bottom||e.bottom<r.top)||(o[t].push(i),o[i].push(t))}return o}(),n=[],l=[],i={},a=[],c=-1,o={colormap:{},allTried:!1,isTodoQueueNotEmpty:function(){return 0<n.length||0<l.length},getNextCellIndexToColor:function(){return(0<n.length?n:l).shift()},queueCellIndex:function(o){if(!(o in this.colormap)){var t=this.getClusterName(o);switch(i[t].length){case 0:case 1:l.indexOf(o)<0&&l.push(o);break;case 2:n.indexOf(o)<0&&n.push(o);break;default:n.unshift(o)}}},recordClusterAdjacentToColor:function(o,t){o in i||(i[o]=[]),i[o].indexOf(t)<0&&i[o].push(t)},createColorClass:function(){for(var o=0;o<u.length;o++)u[o].classList.add("leafc_"+this.colormap[o])},stackColoringOption:function(o,t){var e,r={current:o,coloring_option:t,colormap:{},adjacentColors:{}};for(e in r.lowPriorityTodo=[...l],r.highPriorityTodo=[...n],this.colormap)r.colormap[e]=this.colormap[e];for(e in i)r.adjacentColors[e]=[...i[e]];a.push(r)},rollback_to_diffrent_coloring_option:function(){a.length<=1&&(this.allTried=!0);var o=a.pop();c=o.coloring_option,l=o.lowPriorityTodo,n=o.highPriorityTodo,this.colormap=o.colormap,i=o.adjacentColors},getDiffColor:function(o){let t=i[o];if(void 0===t)return Array.from({length:r},(o,t)=>t+1);diff=[];for(var e=1;e<=r;e++)t.indexOf(e)<0&&diff.push(e);return diff},getAdjacents:function(o){return t[o]},getClusterName:function(o){var t=u[o],o=t.getAttribute(e);return o=null==o?t.getAttribute("transform"):o},getCellsInSameCluster:function(o){let t=[];if(null!=o&&0<o.length)for(var e=0;e<u.length;e++)o==this.getClusterName(e)&&t.push(e);return t},getColorIndexForUnknownCluster:function(){return r+1},isOtherOptionAvailable:function(){return 0<a.length},popAssignedColor:function(){var o=c;return 0<=c&&(c=-1),o}};for(setColorToCell(0,o);o.isTodoQueueNotEmpty();)setColorToCell(o.getNextCellIndexToColor(),o);o.createColorClass()}function setColorToCell(o,t){if(!(o in t.colormap)){var e=t.getClusterName(o),r=t.popAssignedColor();if(r<0)if("unknown"==e)r=t.getColorIndexForUnknownCluster();else{var n=t.getDiffColor(e);if(0<n.length){if(r=n[0],!t.allTried)for(var l=0;l<n.length;l++)t.stackColoringOption(o,n[l])}else{if(t.isOtherOptionAvailable())return void t.rollback_to_diffrent_coloring_option();console.log("Nothing in the option stack."),r=1}}t.colormap[o]=r;for(var i=t.getCellsInSameCluster(e),l=0;l<i.length;l++){var a=i[l];a!=o&&(t.colormap[a]=r)}for(l=0;l<i.length;l++)processNeighborAfterColoring(i[l],r,e,t)}}function processNeighborAfterColoring(o,t,e,r){for(var n=r.getAdjacents(o),l=0;l<n.length;l++){var i=r.getClusterName(n[l]);i!=e&&r.recordClusterAdjacentToColor(i,t)}for(l=0;l<n.length;l++)r.queueCellIndex(n[l])}